(function(n,M){typeof exports=="object"&&typeof module<"u"?M(exports):typeof define=="function"&&define.amd?define(["exports"],M):(n=typeof globalThis<"u"?globalThis:n||self,M((n.karabiner=n.karabiner||{},n.karabiner.ts={})))})(this,function(n){"use strict";const M=["left_control","left_shift","left_option","left_command","right_control","right_shift","right_option","right_command","fn"],le=[...M,"caps_lock"],ue=["return_or_enter","escape","delete_or_backspace","delete_forward","tab","spacebar","hyphen","equal_sign","open_bracket","close_bracket","backslash","non_us_pound","semicolon","quote","grave_accent_and_tilde","comma","period","slash","non_us_backslash"],ce=["up_arrow","down_arrow","left_arrow","right_arrow","page_up","page_down","home","end"],de=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],fe=["1","2","3","4","5","6","7","8","9","0"],_e=["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20"],he=["keypad_num_lock","keypad_slash","keypad_asterisk","keypad_hyphen","keypad_plus","keypad_enter","keypad_1","keypad_2","keypad_3","keypad_4","keypad_5","keypad_6","keypad_7","keypad_8","keypad_9","keypad_0","keypad_period","keypad_equal_sign","keypad_comma"],pe=["print_screen","scroll_lock","pause","insert","application","help","power"],me=["international1","international3","lang1","lang2"],ye=["japanese_eisuu","japanese_kana"],be=["volume_down","volume_up","mute","volume_decrement","volume_increment"],I=["f21","f22","f23","f24","execute","menu","select","stop","again","undo","cut","copy","paste","find","international2","international4","international5","international6","international7","international8","international9","lang3","lang4","lang5","lang6","lang7","lang8","lang9","japanese_pc_nfer","japanese_pc_xfer","japanese_pc_katakana","keypad_equal_sign_as400","locking_caps_lock","locking_num_lock","locking_scroll_lock","alternate_erase","sys_req_or_attention","cancel","clear","prior","return","separator","out","oper","clear_or_again","cr_sel_or_props","ex_sel"],O=["vk_none","vk_consumer_brightness_down","vk_consumer_brightness_up","vk_mission_control","vk_launchpad","vk_dashboard","vk_consumer_illumination_down","vk_consumer_illumination_up","vk_consumer_previous","vk_consumer_play","vk_consumer_next","display_brightness_decrement","display_brightness_increment","rewind","play_or_pause","fastforward","apple_display_brightness_decrement","apple_display_brightness_increment","dashboard","launchpad","mission_control","apple_top_case_display_brightness_decrement","apple_top_case_display_brightness_increment","illumination_decrement","illumination_increment"],xe=["rewind","play_or_pause","fast_forward","mute","volume_decrement","volume_increment","al_terminal_lock_or_screensaver","eject","scan_previous_track","scan_next_track","al_word_processor","al_text_editor","al_spreadsheet","al_presentation_app","al_email_reader","al_calculator","al_local_machine_browser","al_internet_browser","al_dictionary","fastforward"],et=["menu","al_graphics_editor","al_database_app","al_newsreader","al_voicemail","al_contacts_or_address_book","al_Calendar_Or_Schedule","al_task_or_project_manager","al_log_or_journal_or_timecard","al_checkbook_or_finance","al_a_or_v_capture_or_playback","al_lan_or_wan_browser","al_remote_networking_or_isp_connect","al_network_conference","al_network_chat","al_telephony_or_dialer","al_logon","al_logoff","al_logon_or_logoff","al_control_panel","al_command_line_processor_or_run","al_process_or_task_manager","al_select_task_or_application","al_next_task_or_application","al_previous_task_or_application","al_preemptive_halt_task_or_application","al_integrated_help_center","al_documents","al_thesaurus","al_desktop","al_spell_check","al_grammer_check","al_wireless_status","al_keyboard_layout","al_virus_protection","al_encryption","al_screen_saver","al_alarms","al_clock","al_file_browser","al_power_status","al_image_browser","al_audio_browser","al_movie_browser","al_digital_rights_manager","al_digital_wallet","al_instant_messaging","al_oem_feature_browser","al_oem_help","al_online_community","al_entertainment_content_browser","al_online_shopping_browswer","al_smart_card_information_or_help","al_market_monitor_or_finance_browser","al_customized_corporate_news_browser","al_online_activity_browswer","al_research_or_search_browswer","al_audio_player","al_message_status","al_contact_sync","al_navigation","al_contextaware_desktop_assistant","ac_home","ac_back","ac_forward","ac_refresh","ac_bookmarks","menu_pick","menu_up","menu_down","menu_left","menu_right","menu_escape","menu_value_increase","menu_value_decrease","data_on_screen","closed_caption","closed_caption_select","vcr_or_tv","broadcast_mode","snapshot","still","picture_in_picture_toggle","picture_in_picture_swap","red_menu_button","green_menu_button","blue_menu_button","yellow_menu_button","aspect","three_dimensional_mode_select"],tt=["display_brightness_decrement","display_brightness_increment","dictation"],it=["button1","button2","button3","button4","button5","button6","button7","button8","button9","button10","button11","button12","button13","button14","button15","button16","button17","button18","button19","button20","button21","button22","button23","button24","button25","button26","button27","button28","button29","button30","button31","button32"],$={"⌘":"command","⌥":"option","⌃":"control","⇧":"shift","⇪":"caps_lock"},Z={"↑":"up_arrow","↓":"down_arrow","←":"left_arrow","→":"right_arrow","⇞":"page_up","⇟":"page_down","↖︎":"home","↘︎":"end"},x={"⏎":"return_or_enter","⎋":"escape","⌫":"delete_or_backspace","⌦":"delete_forward","⇥":"tab","␣":"spacebar","-":"hyphen","=":"equal_sign","[":"open_bracket","]":"close_bracket","\\":"backslash",";":"semicolon","'":"quote","`":"grave_accent_and_tilde",",":"comma",".":"period","/":"slash"},ge={...Z,...x,"⇪":$["⇪"]},ot=[...M,...le,...ue,...ce,...de,...fe,..._e,...he,...pe,...me,...ye,...be,...I,...O];function K(t,e,i){if(typeof t=="number")return`${t}`;if(t.length>1&&q(t)){const r=J(t);if((r==null?void 0:r.length)===1)return r[0];throw new Error(`Invalid key ${t}`)}if(t in ge)return ge[t];const o=t;if(!ot.includes(o))throw new Error(`${o} is not valid key_code`);if(e!=null&&e.includes(o))throw new Error(`Key ${t} cannot be used ${i||"here"}`);return o}const ke={Meh:["option","control","shift"],Hyper:["command","option","control","shift"],SuperHyper:["command","option","control","shift","fn"]},ee={"⌘⇧":["command","shift"],"⌥⇧":["option","shift"],"⌃⇧":["control","shift"],"⌘⌥":["command","option"],"⌘⌃":["command","control"],"⌥⌃":["option","control"],"⌘⌥⌃":["command","option","control"],"⌘⌥⇧":["command","option","shift"],"⌘⌃⇧":["command","control","shift"],"⌥⌃⇧":["option","control","shift"],"⌘⌥⌃⇧":["command","option","control","shift"],...ke};function A(t){if(!t)return;if(typeof t=="string")return q(t)?J(t):t in $?[$[t]]:t in ee?ee[t]:[t];if(Array.isArray(t))return rt(t)?st(t):t.map(at);let e;"left"in t?e=j("left",t.left):"l"in t&&(e=j("left",t.l));let i;if("right"in t?i=j("right",t.right):"r"in t&&(i=j("right",t.r)),!(!(e!=null&&e.length)&&!(i!=null&&i.length)))return[...e||[],...i||[]]}const we=/^(left|l|<|‹)([⌘⌥⌃⇧]*)$/,ve=/^(right|r|>|›)([⌘⌥⌃⇧]*)$/;function P(t,e){if(!(!t&&!e))return{mandatory:Ce(t),optional:Ce(e)}}function Ce(t){if(t)return t==="any"?["any"]:A(t)}const nt=new Set(["command","option","control","shift"]);function q(t){return we.test(t)||ve.test(t)}function J(t){const e=t.match(we);if(e)return j("left",e[2]);const i=t.match(ve);if(i)return j("right",i[2])}function rt(t){return t.some(q)}function st(t){return t.reduce((e,i)=>[...e,...q(i)?J(i)||[]:A(i)||[]],[])}function j(t,e){var i;if(e)return(i=A(e))==null?void 0:i.map(o=>nt.has(o)?`${t}_${o}`:o)}function at(t){return t in $?$[t]:t}function v(t){return Array.isArray(t)?t:[t]}function g(t,e=1,i){return new k({type:"variable_if",name:t,value:e,description:i})}function lt(t,e){var o,r;let i;if(Array.isArray(t))i=t.map(W);else if(typeof t=="string"||t instanceof RegExp)i=[W(t)];else return new k({type:"frontmost_application_if",description:e,file_paths:(o=t.file_paths)==null?void 0:o.map(W),bundle_identifiers:(r=t.bundle_identifiers)==null?void 0:r.map(W)});return new k({type:"frontmost_application_if",description:e,bundle_identifiers:i})}function ut(t,e){return new k({type:"device_if",identifiers:v(t),description:e})}function ct(t,e){return new k({type:"device_exists_if",identifiers:v(t),description:e})}function dt(t,e){return new k({type:"keyboard_type_if",keyboard_types:v(t),description:e})}function ft(t,e){return new k({type:"input_source_if",input_sources:v(t),description:e})}function _t(t=!0,e){return new k({type:"event_changed_if",value:t,description:e})}const ht=pt({frontmost_application_if:"frontmost_application_unless",device_if:"device_unless",device_exists_if:"device_exists_unless",keyboard_type_if:"keyboard_type_unless",input_source_if:"input_source_unless",variable_if:"variable_unless",event_changed_if:"event_changed_unless"});class k{constructor(e){this.condition=e}unless(){return new k({...this.condition,type:ht[this.condition.type]})}build(){return{...this.condition}}}function Me(t){return typeof t.build=="function"}function S(t){return Me(t)?t.build():t}function W(t){return typeof t=="string"?t:t.toString().slice(1,-1)}function pt(t){return Object.keys(t).reduce((e,i)=>({...e,[e[i]]:i}),t)}const mt=["optionalAny","?any","??"];function yt(t){return!t||typeof t!="string"?!1:mt.includes(t)}function bt(t){return/^\?(left|l|<|‹|right|r|>|›)?([⌘⌥⌃⇧⇪]*)$/.test(t)}function y(t,e){if(!t)return P(t,e);if(yt(t))return P("","any");if(typeof t=="string"){if(bt(t))return P("",A(t.slice(1)));if(t.startsWith("?"))throw new Error(`${t} is not valid optional alias`)}return typeof t=="object"&&"optional"in t?P("",t.optional):P(t,e)}function D(t,e,i){if(typeof t=="object")return new L(t);const o=K(t,O,"for from.key_code");return new L({key_code:o,modifiers:y(e,i)})}function gt(t,e,i){return new L({consumer_key_code:t,modifiers:y(e,i)})}function kt(t,e,i){return new L({pointing_button:t,modifiers:y(e,i)})}function p(t,e,i){const o=K(t,I,"as to.key_code");return{...i,key_code:o,modifiers:e?A(e):void 0}}function Ke(t){return p("left_command","⌥⌃⇧",t)}function Ae(t){return p("left_option","⌃⇧",t)}function Se(t){return p("fn","⌘⌥⌃⇧",t)}function Ee(t){return p("vk_none",void 0,t)}function Te(t,e,i){return{...i,consumer_key_code:t,modifiers:e?A(e):void 0}}function Oe(t,e,i){return{...i,pointing_button:t,modifiers:e?A(e):void 0}}function R(t){return{shell_command:t}}function $e(t){const e=t.match(/^"?(.*?)(.app)?"?$/);return R(`open -a "${(e==null?void 0:e[1])||t}".app`)}function Pe(t){return R(`osascript -e '
set prev to the clipboard
set the clipboard to "${t}"
tell application "System Events"
  keystroke "v" using command down
  delay 0.1
end tell
set the clipboard to prev'`)}const je=["Tink","Submarine","Sosumi","Morse","Ping","Pop","Purr","Glass","Hero","Frog","Funk","Blow","Bottle","Basso"];function wt(t){const e=je.includes(t)?`/System/Library/Sounds/${t}.aiff`:t;return R(`afplay ${e}`)}function De(t){return{select_input_source:t}}function h(t,e=1,i,o){return{set_variable:{name:t,value:e,key_up_value:i,type:o}}}function Ve(t){return{set_variable:{name:t,type:"unset"}}}function te(t,e){return{set_notification_message:{id:t,text:e}}}function U(t){return{set_notification_message:{id:t,text:""}}}function Le(t){return{mouse_key:t}}function Ne(t,e="toggle"){return{sticky_modifier:{[t]:e}}}function Be(t){return{software_function:{cg_event_double_click:{button:t}}}}function Ie(t){return{software_function:{set_mouse_cursor_position:t}}}function qe(t){return{software_function:{iokit_power_management_sleep_system:{delay_milliseconds:t}}}}const V={};for(let t=0;t<=9;t++)V[t]=p(t);const vt="abcdefghijklmnopqrstuvwxyz".split("");for(const t of vt)V[t]=p(t),V[t.toUpperCase()]=p(t,"⇧");const Ct=[...Object.keys(Z),...Object.keys(x)];for(const t of Ct)V[t]=p(t);const Mt={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","'":'"',"=":"+",";":":",",":"<",".":">","/":"?","-":"_","[":"{","\\":"|","]":"}","`":"~"};for(const[t,e]of Object.entries(Mt))V[e]=p(t,"⇧");function Re(t,e){return t.split("").map(i=>{const o=(e==null?void 0:e[i])||V[i];if(!o)throw new Error(`${i} is unknown. Please provide a map with { ${i}: {ToEvent} }`);return o})}class L{constructor(e){this.manipulator={type:"basic",from:e}}get from(){return this.manipulator.from}to(e,i,o){return this.addToEvent(typeof e=="object"?e:p(e,i,o)),this}toHyper(e){return this.addToEvent(Ke(e)),this}toMeh(e){return this.addToEvent(Ae(e)),this}toSuperHyper(e){return this.addToEvent(Se(e)),this}toNone(e){return this.addToEvent(Ee(e)),this}toConsumerKey(e,i,o){return this.addToEvent(Te(e,i,o)),this}toPointingButton(e,i,o){return this.addToEvent(Oe(e,i,o)),this}to$(e){return this.addToEvent(R(e)),this}toApp(e){return this.addToEvent($e(e)),this}toPaste(e){return this.addToEvent(Pe(e)),this}toInputSource(e){return this.addToEvent(De(e)),this}toVar(e,i=1,o,r){return this.addToEvent(h(e,i,o,r)),this}toUnsetVar(e){return this.addToEvent(Ve(e)),this}toNotificationMessage(e,i){return this.addToEvent(te(e,i)),this}toRemoveNotificationMessage(e){return this.addToEvent(U(e)),this}toMouseKey(e){return this.addToEvent(Le(e)),this}toStickyModifier(e,i="toggle"){return this.addToEvent(Ne(e,i)),this}toCgEventDoubleClick(e){return this.addToEvent(Be(e)),this}toMouseCursorPosition(e){return this.addToEvent(Ie(e)),this}toSleepSystem(e){return this.addToEvent(qe(e)),this}toTypeSequence(e,i){return this.addToEvent(Re(e,i)),this}toIfAlone(e,i,o){return this.pushOrCreateList(this.manipulator,"to_if_alone",typeof e=="object"?e:p(e,i,o)),this}toIfHeldDown(e,i,o){return this.pushOrCreateList(this.manipulator,"to_if_held_down",typeof e=="object"?e:p(e,i,o)),this}toAfterKeyUp(e,i,o){return this.pushOrCreateList(this.manipulator,"to_after_key_up",typeof e=="object"?e:p(e,i,o)),this}toDelayedAction(e,i){const o=this.manipulator.to_delayed_action||{to_if_invoked:[],to_if_canceled:[]};return v(e).forEach(r=>o.to_if_invoked.push(r)),v(i).forEach(r=>o.to_if_canceled.push(r)),this.manipulator.to_delayed_action=o,this}description(e){return this.manipulator.description=e,this}condition(...e){const{conditions:i=[]}=this.manipulator;return this.manipulator.conditions=[...i,...e.map(S)],this}parameters(e){return this.manipulator.parameters={...this.manipulator.parameters,...e},this}build(e){return[{...this.manipulator}]}addToEvent(e){this.pushOrCreateList(this.manipulator,"to",e)}pushOrCreateList(e,i,o){const r=e[i]||[];v(o).forEach(s=>r.push(s)),Object.assign(e,{[i]:r})}}function Kt(t){return typeof t.build=="function"}function N(t,e){return Kt(t)?t.build(e):"type"in t?[t]:Object.entries(t).reduce((o,[r,s])=>[...o,...D(r).to(s).build(e)],[])}function At(...t){return e=>{const i=t.map(S);function o(a){return a.type!=="basic"?a:{...a,conditions:[...a.conditions||[],...i]}}const s=(Array.isArray(e)?e:N(e)).reduce((a,c)=>[...a,...N(c).map(o)],[]);return Object.assign(s,{build:()=>s})}}function St(t){return e=>({build:()=>(Array.isArray(t)?t.map((o,r)=>[o,r]):Object.entries(t)).reduce((o,[r,s])=>[...o,...N(e(r,s))],[])})}function Et(t,e){return i=>({build:o=>{const r=y(t,e);return(Array.isArray(i)?i:N(i)).map(a=>N(a,o)).reduce((a,c)=>a.concat(c),[]).map(a=>{var l;const c=Object.keys(r).reduce((u,d)=>{var f;if(!((f=r[d])!=null&&f.length))return u;const m=new Set([...u[d]||[],...r[d]]);return u[d]=m.has("any")?["any"]:Array.from(m),u},{...(l=a.from)==null?void 0:l.modifiers});return a.from={...a.from,modifiers:c},a})}})}function Ue(t,e,i){const o=s=>K(s,O,"for from.simultaneous"),r=new Tt({simultaneous:t.map(s=>typeof s=="object"?s:{key_code:o(s)}),simultaneous_options:e});return i&&r.parameters({"basic.simultaneous_threshold_milliseconds":i}),r}class Tt extends L{constructor(e){super(e)}modifiers(e,i){return this.manipulator.from.modifiers=e||i?y(e,i):void 0,this}}const Fe="__support__manipulator";function Ot(t){return t.description=(t.description||"")+Fe,t}function ie(t){var e;return(e=t.description)==null?void 0:e.endsWith(Fe)}const oe={"double_tap.delay_milliseconds":200};function $t(t,e,i,o){const r=K(t,[...I,...O],"for double tap"),s=new Pt({key_code:r});return o?(s.delay(o),s.from.modifiers=y(e,i)):i?typeof i=="number"?(s.delay(i),s.from.modifiers=y(e)):s.from.modifiers=y(e,i):e&&(typeof e=="number"?s.delay(e):s.from.modifiers=y(e)),s}class Pt extends L{constructor(e){super(e),this.singleTapEvent=void 0}singleTap(e){return this.singleTapEvent=e,this}delay(e){return this.delayParam=e,this}build(e){var m;const i=(e==null?void 0:e.getParameters(oe))??oe,o=this.delayParam||i["double_tap.delay_milliseconds"],r=this.from.key_code;if(this.singleTapEvent===void 0){this.singleTapEvent={key_code:r};const f=(m=this.manipulator.from.modifiers)==null?void 0:m.mandatory;f&&(this.singleTapEvent.modifiers=f.filter(E=>E!=="any"))}const s=["double-tap",r];this.from.modifiers&&[this.from.modifiers.mandatory,this.from.modifiers.optional].map(f=>f!=null&&f.length?f.join(","):"").forEach(f=>f&&s.push(f));const a=s.join("-"),c=g(a).build(),l=g(a).unless().build(),u=Ot({...this.manipulator,conditions:[c]}),d={...this.manipulator,to:[h(a,1)],conditions:[...this.manipulator.conditions||[],l],to_delayed_action:{to_if_invoked:[...this.singleTapEvent?[this.singleTapEvent]:[],h(a,0)],to_if_canceled:[h(a,0)]}};return d.parameters={"basic.to_delayed_action_delay_milliseconds":o},[u,d]}}function jt(){return new Dt}class Dt{constructor(){this.manipulator={type:"mouse_motion_to_scroll"}}modifiers(e,i){return this.manipulator.from={modifiers:y(e,i)},this}condition(...e){const{conditions:i=[]}=this.manipulator;return this.manipulator.conditions=[...i,...e.map(S)],this}options(e){return this.manipulator.options={...this.manipulator.options,...e},this}build(e){return[{...this.manipulator}]}}function Vt(t,...e){return new z(t,...e)}class z{constructor(e,...i){this.ruleDescription=e,this.manipulatorSources=[],this.allowEmptyManipulators=!1,this.conditions=i}manipulators(e){return Array.isArray(e)?e.forEach(i=>this.manipulatorSources.push(i)):this.manipulatorSources.push(e),this}condition(...e){return e.forEach(i=>this.conditions.push(i)),this}description(e){return this.ruleDescription=e,this}build(e){const i={description:this.ruleDescription,manipulators:this.manipulatorSources.reduce((r,s)=>[...r,...N(s,e)],[])};if(!this.allowEmptyManipulators&&i.manipulators.length===0)throw new Error(`"manipulators" is empty in "${i.description}"`);if(this.conditions.length===0)return i;const o=this.conditions.map(S);return i.manipulators=i.manipulators.map(r=>r.type==="basic"&&!ie(r)?{...r,conditions:[...r.conditions||[],...o]}:{...r}),i}}function Lt(t){return typeof t.build=="function"}function Nt(t,e){return Lt(t)?t.build(e):t}const G={escape:["escape","caps_lock"]};function He(t,e,i){const o=[];if(!t)return o;for(const r of Array.isArray(t)?t:[t]){const s=D(r);o.push(...s.condition(e).to(i).build())}return o}const ne=[...O,...I,...M];function Je(t,e,i=1,o=0){return new It(t,e,i,o)}function We(t,e,i,o=1,r=0){return Je(e,i,o,r).modifiers(t)}function Bt(t,e,i=1,o=0){return We("Hyper",t,e,i,o)}const Q="__layer";class It extends z{constructor(e,i,o=1,r=0){const s=v(e).map(a=>K(a,ne,"as layer key"));i||(i=`layer-${s.join("-")}`),super(`Layer - ${i}`),this.onValue=o,this.offValue=r,this.replaceLayerKeyToIfAlone=!1,this.keys=s,this.varName=i,this.layerCondition=g(this.varName,this.onValue),this.condition(this.layerCondition),this.allowEmptyManipulators=!0}modifiers(e,i){return this.layerModifiers=e||i?y(e,i):void 0,this}configKey(e,i=!1){return this.layerKeyManipulator||(this.layerKeyManipulator=D("fn")),e(this.layerKeyManipulator),this.replaceLayerKeyToIfAlone=i,this}notification(e=!0){return this.layerNotification=e,this}leaderMode(e=!0){return e===!0?this.leaderModeOptions=G:e?this.leaderModeOptions={...G,...e}:this.leaderModeOptions=void 0,this}build(e){var r,s,a,c;const i=super.build(e);if(this.leaderModeOptions){const l=[h(this.varName,this.offValue),h(Q,0)];this.layerNotification&&l.push(U(Qe(this.varName))),this.leaderModeOptions.sticky||i.manipulators.forEach(u=>u.type==="basic"&&!ie(u)&&(u.to=(u.to||[]).concat(l))),i.manipulators.push(...He(this.leaderModeOptions.escape,g(this.varName,this.onValue),l))}if((s=(r=this.layerModifiers)==null?void 0:r.mandatory)!=null&&s.length||(c=(a=this.layerModifiers)==null?void 0:a.optional)!=null&&c.length){const l=Ge(this.layerModifiers)==="optional";i.manipulators.forEach(u=>this.addModifierAnyToManipulator(u,l))}const o=this.conditions.filter(l=>l!==this.layerCondition).map(S);for(const l of this.keys)i.manipulators=[...ze(l,this.varName,this.onValue,this.offValue,this.layerModifiers,o,e,this.layerKeyManipulator,this.replaceLayerKeyToIfAlone,this.layerNotification===!0?this.ruleDescription:this.layerNotification||void 0,this.leaderModeOptions),...i.manipulators];return i}addModifierAnyToManipulator(e,i){if(e.type==="basic"){if(e.from.modifiers){const{mandatory:o,optional:r}=e.from.modifiers;if(r!=null&&r.length||o!=null&&o.length){const s=Ge(e.from.modifiers);if(s==="mandatory")e.from.modifiers={mandatory:["any"]};else if(s==="optional")e.from.modifiers={optional:["any"]};else throw new Error("Layers with modifiers cannot have modifiers on manipulators");return}}e.from.modifiers=i?{optional:["any"]}:{mandatory:["any"]}}}}function ze(t,e,i,o,r,s,a,c,l,u,d){var H;function m(_){var Ze;if(!c)return _;const b=c.build()[0],T=v(_)[0];if(["to","to_if_alone","to_if_held_down","to_after_key_up"].forEach(C=>{var X;return(X=b[C])==null?void 0:X.forEach(Y=>T[C]=[...T[C]||[],Y])}),b.to_delayed_action){T.to_delayed_action=T.to_delayed_action||{to_if_invoked:[],to_if_canceled:[]};for(const C of["to_if_invoked","to_if_canceled"])b.to_delayed_action[C].forEach(X=>{var Y;return(Y=T.to_delayed_action)==null?void 0:Y[C].push(X)})}return l&&(T.to_if_alone=(Ze=T.to_if_alone)==null?void 0:Ze.filter(C=>!("key_code"in C&&C.key_code===t))),_}const f=D({key_code:t,modifiers:r}).toVar(e,i).toVar(Q).condition(g(e,i).unless(),g(Q).unless());if(!((H=r==null?void 0:r.mandatory)!=null&&H.length)&&!d&&f.toIfAlone({key_code:t}),d||f.toAfterKeyUp(h(e,o)).toAfterKeyUp(h(Q,0)),s!=null&&s.length&&f.condition(...s),u){const _=Qe(e);f.toNotificationMessage(_,u),d||f.toAfterKeyUp(U(_))}if(!a)return m(f.build());const E=[`layer_${t}`,...r?[JSON.stringify(r)]:[],...(s||[]).map(_=>JSON.stringify(_)).sort()].join("_"),w=a.getCache(E);if(w!=null&&w.to&&w.to_after_key_up)return w.to.find(b=>"set_variable"in b&&b.set_variable.name===e)||(w.to.push(h(e,i)),w.to_after_key_up.push(h(e,o))),m(w),[];const F=f.build(a);return a.setCache(E,F[0]),m(F)}function Ge({mandatory:t,optional:e}){return(t==null?void 0:t.length)===1&&t[0]==="any"?"mandatory":(e==null?void 0:e.length)===1&&e[0]==="any"?"optional":null}function Qe(t){return`layer-${t}`}const re={"simlayer.threshold_milliseconds":200};function qt(t,e,i,o=1,r=0){return new Rt(t,e,i,o,r)}class Rt extends z{constructor(e,i,o,r=1,s=0){const a=v(e).map(c=>K(c,ne,"as simlayer key"));i||(i=`simlayer-${a.join("-")}`),super(`Simlayer - ${i}`),this.threshold=o,this.onValue=r,this.offValue=s,this.sharedLayerKeys=[],this.simultaneousOptions={detect_key_down_uninterruptedly:!0,key_down_order:"strict",key_up_order:"strict_inverse",key_up_when:"any"},this.layerModifiers={optional:["any"]},this.ifActivated=[],this.ifDeactivated=[],this.keys=a,this.varName=i,this.layerCondition=g(this.varName,this.onValue),this.condition(this.layerCondition)}modifiers(e,i){return this.layerModifiers=e||i?y(e,i):void 0,this}options(e){return Object.assign(this.simultaneousOptions,e),this}enableLayer(...e){return e.map(i=>K(i,ne,"as layer key")).forEach(i=>{if(this.keys.includes(i))throw new Error(`Key ${i} is already used in ${this.ruleDescription}`);if(this.sharedLayerKeys.includes(i))throw new Error(`Key ${i} is already used as shared layer key in  ${this.ruleDescription}`);this.sharedLayerKeys.push(i)}),this}toIfActivated(e){return this.ifActivated.push(e),this}toIfDeactivated(e){return this.ifDeactivated.push(e),this}build(e){const i=super.build(e),o=(e==null?void 0:e.getParameters(re))??re,r=this.threshold||o["simlayer.threshold_milliseconds"],s=this.conditions.length>1?this.conditions.filter(l=>l!==this.layerCondition).map(S):void 0,a=h(this.varName,this.onValue),c=h(this.varName,this.offValue);i.manipulators.concat().forEach(l=>{var d;if(l.type!=="basic")throw new Error(`Unsupported manipulator type ${l.type} in simlayer ${this.ruleDescription}`);const u=(d=l.from)==null?void 0:d.key_code;if(!u)throw new Error(`Missing from.key_code in simlayer ${this.ruleDescription}`);this.layerModifiers&&(l.from.modifiers={...l.from.modifiers,...this.layerModifiers});for(const m of this.keys)i.manipulators.push({type:"basic",parameters:{"basic.simultaneous_threshold_milliseconds":r},to:[a,...l.to||[],...this.ifActivated],from:{simultaneous:[{key_code:m},{key_code:u}],simultaneous_options:{...this.simultaneousOptions,to_after_key_up:[...this.simultaneousOptions.to_after_key_up||[],c,...this.ifDeactivated]},modifiers:this.layerModifiers},conditions:s})});for(const l of this.sharedLayerKeys)i.manipulators=[...ze(l,this.varName,this.onValue,this.offValue,this.layerModifiers,s,e),...i.manipulators];return i}}const se={"duo_layer.threshold_milliseconds":200,"duo_layer.notification":!1};function Ut(t,e,i,o=1,r=0){return new Ft(t,e,i,o,r)}class Ft extends z{constructor(e,i,o,r=1,s=0){const a=`DuoLayer ${o||`${e} ${i}`}`;o||(o=`duo-layer-${e}-${i}`),super(a),this.key1=e,this.key2=i,this.onValue=r,this.offValue=s,this.simultaneousOptions={},this.ifActivated=[],this.ifDeactivated=[],this.varName=o,this.layerCondition=g(this.varName,this.onValue),this.condition(this.layerCondition),this.allowEmptyManipulators=!0}threshold(e){return this.simultaneousThreshold=e,this}options(e){return Object.assign(this.simultaneousOptions,e),this}notification(e=!0){return this.layerNotification=e,this}toIfActivated(e){return this.ifActivated.push(e),this}toIfDeactivated(e){return this.ifDeactivated.push(e),this}leaderMode(e=!0){return e===!0?this.leaderModeOptions=G:e?this.leaderModeOptions={...G,...e}:this.leaderModeOptions=void 0,this}build(e){var E,w,F,H;const i=super.build(e),o=(e==null?void 0:e.getParameters(se))??se,r=this.simultaneousThreshold||o["duo_layer.threshold_milliseconds"],s=this.layerNotification??o["duo_layer.notification"],a=this.conditions.filter(_=>_!==this.layerCondition).map(S),c=[h(this.varName,this.onValue),...this.ifActivated],l=[h(this.varName,this.offValue),...this.ifDeactivated];if(s){const _=`duo-layer-${this.varName}`,b=s===!0?this.ruleDescription:s;c.push(te(_,b)),l.push(U(_))}this.leaderModeOptions&&(this.leaderModeOptions.sticky||i.manipulators.forEach(_=>_.type==="basic"&&!ie(_)&&(_.to=(_.to||[]).concat(l))),i.manipulators.push(...He(this.leaderModeOptions.escape,g(this.varName,this.onValue),l)));const u=this.simultaneousOptions.to_after_key_up||[];this.leaderModeOptions||u.push(...l);const d=Ue([this.key1,this.key2],{...this.simultaneousOptions,to_after_key_up:u},r).modifiers("??").to(c).condition(g(this.varName,this.onValue).unless());if(a.length&&d.condition(...a),!e)return i.manipulators=[...d.build(),...i.manipulators],i;const m=[`duo_layer_${this.key1}_${this.key2}`,...a.map(_=>JSON.stringify(_)).sort()].join("_"),f=e.getCache(m);if(f)((E=f.to)==null?void 0:E.find(b=>"set_variable"in b&&b.set_variable.name===this.varName))||((w=f.to)==null||w.push(h(this.varName,this.onValue)),(H=(F=f.from.simultaneous_options)==null?void 0:F.to_after_key_up)==null||H.push(h(this.varName,this.offValue)));else{const _=d.build(e)[0];e.setCache(m,_),i.manipulators=[_,...i.manipulators]}return i}}class Ht{constructor(){this.parameters={},this.cache=new Map}setParameters(e){Object.assign(this.parameters,e)}getParameters(e){const i={...e};for(const o of Object.keys(e))o in this.parameters&&this.parameters[o]!==void 0&&Object.assign(i,{[o]:this.parameters[o]});return i}getCache(e){return this.cache.get(e)}setCache(e,i){this.cache.set(e,i)}}const Xe={"basic.to_if_alone_timeout_milliseconds":1e3,"basic.to_if_held_down_threshold_milliseconds":500,"basic.to_delayed_action_delay_milliseconds":500,"basic.simultaneous_threshold_milliseconds":50,"mouse_motion_to_scroll.speed":100};function Ye(t,e={}){const{"double_tap.delay_milliseconds":i,"simlayer.threshold_milliseconds":o,"duo_layer.threshold_milliseconds":r,"duo_layer.notification":s,...a}=e,c=new Ht;c.setParameters({"double_tap.delay_milliseconds":i}),c.setParameters({"simlayer.threshold_milliseconds":o}),c.setParameters({"duo_layer.threshold_milliseconds":r,"duo_layer.notification":s});const l=t.map(d=>Nt(d,c)),u={rules:l.filter(d=>d.manipulators.length),parameters:{...Xe,...a}};if(u.rules.length===0)throw new Error('complex_modifications "rules" is empty ');return u.rules.length<l.length&&console.warn(`Rules with empty manipulators are ignored: 
${l.filter(d=>d.manipulators.length===0).map(d=>"- "+d.description).join(`
`)}
`),u}const B={karabinerConfigDir(){return require("node:path").join(require("node:os").homedir(),".config/karabiner")},karabinerConfigFile(){return require("node:path").join(this.karabinerConfigDir(),"karabiner.json")},readKarabinerConfig(t){return require(t??this.karabinerConfigFile())},writeKarabinerConfig(t,e){return require("node:fs/promises").writeFile(e??this.karabinerConfigFile(),t)},readJson(t){return require(t)},exit(t=0){process.exit(t)}};function Jt(t,e,i={}){typeof t=="string"&&(t={name:t,dryRun:t==="--dry-run"});const{name:o,dryRun:r}=t,s=t.karabinerJsonPath??B.karabinerConfigFile(),a=r?{profiles:[{name:o,complex_modifications:{rules:[]}}]}:B.readKarabinerConfig(s),c=a==null?void 0:a.profiles.find(u=>u.name===o);c||ae(`⚠️ Profile ${o} not found in ${s}.

ℹ️ Please check the profile name in the Karabiner-Elements UI and 
    - Update the profile name at writeToProfile()
    - Create a new profile if needed
 `);try{c.complex_modifications=Ye(e,i)}catch(u){ae(u)}const l=JSON.stringify(a,null,2);if(r){console.info(l);return}B.writeKarabinerConfig(l,s).catch(ae),console.log(`✓ Profile ${o} updated.`)}function ae(t){return t&&console.error(typeof t=="string"?t:t.message||t),B.exit(1)}function Wt(t){return{build(){const e=B.readJson(t);if(!Array.isArray(e==null?void 0:e.rules))throw new Error(`Cannot file rules in ${t}`);return{description:`Imported from ${t}`,manipulators:e.rules.reduce((i,o)=>i.concat(o.manipulators),[])}}}}function zt(t,e){return{build(){const o=B.readKarabinerConfig(e).profiles.find(r=>r.name===t);if(!o)throw new Error(`Profile ${t} not found`);return{description:`Imported from profile ${t}`,manipulators:o.complex_modifications.rules.reduce((r,s)=>r.concat(s.manipulators),[])}}}}n.ConditionBuilder=k,n.arrowKeyAliases=Z,n.arrowKeyCodes=ce,n.buildCondition=S,n.complexModifications=Ye,n.controlOrSymbolKeyAliases=x,n.controlOrSymbolKeyCodes=ue,n.defaultComplexModificationsParameters=Xe,n.defaultDoubleTapParameters=oe,n.defaultDuoLayerParameters=se,n.defaultSimlayerParameters=re,n.duoLayer=Ut,n.fromAndToConsumerKeyCodes=xe,n.fromOnlyConsumerKeyCodes=et,n.fromOnlyKeyCodes=I,n.functionKeyCodes=_e,n.getKeyWithAlias=K,n.hyperLayer=Bt,n.ifApp=lt,n.ifDevice=ut,n.ifDeviceExists=ct,n.ifEventChanged=_t,n.ifInputSource=ft,n.ifKeyboardType=dt,n.ifVar=g,n.importJson=Wt,n.importProfile=zt,n.internationalKeyCodes=me,n.isConditionBuilder=Me,n.isSideMultiModifierAlias=q,n.japaneseKeyCodes=ye,n.keypadKeyCodes=he,n.layer=Je,n.letterKeyCodes=de,n.map=D,n.mapConsumerKey=gt,n.mapDoubleTap=$t,n.mapPointingButton=kt,n.mapSimultaneous=Ue,n.modifierKeyAliases=$,n.modifierKeyCodes=le,n.modifierLayer=We,n.mouseMotionToScroll=jt,n.multiModifierAliases=ee,n.namedMultiModifierAliases=ke,n.numberKeyCodes=fe,n.otherKeyCodes=be,n.parseFromModifierParams=P,n.parseModifierParam=A,n.parseSideMultiModifierAlias=J,n.pcKeyboardKeyCodes=pe,n.pointingButtons=it,n.rule=Vt,n.simlayer=qt,n.stickyModifierKeyCodes=M,n.systemSounds=je,n.to$=R,n.toApp=$e,n.toCgEventDoubleClick=Be,n.toConsumerKey=Te,n.toHyper=Ke,n.toInputSource=De,n.toKey=p,n.toMeh=Ae,n.toMouseCursorPosition=Ie,n.toMouseKey=Le,n.toNone=Ee,n.toNotificationMessage=te,n.toOnlyConsumerKeyCodes=tt,n.toOnlyKeyCodes=O,n.toPaste=Pe,n.toPlaySound=wt,n.toPointingButton=Oe,n.toRemoveNotificationMessage=U,n.toSetVar=h,n.toSleepSystem=qe,n.toStickyModifier=Ne,n.toSuperHyper=Se,n.toTypeSequence=Re,n.toUnsetVar=Ve,n.withCondition=At,n.withMapper=St,n.withModifier=Et,n.writeToProfile=Jt,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
